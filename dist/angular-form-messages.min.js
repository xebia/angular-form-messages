angular.module("angularFormMessages",[]),angular.module("angularFormMessages").directive("afField",["$interpolate","MESSAGE_TYPES","AfMessageService",function(a,b,c){return{require:["ngModel","afField","^afSubmit","^form"],controller:function(){function a(a){return function(b){c.$messages[b]={type:a}}}var c=this;this.$messages={},this.setMessageDetails=function(b,c){a(c)(b)},this.setErrorDetails=a(b[3]),this.setWarningDetails=a(b[2]),this.setInfoDetails=a(b[1]),this.setSuccessDetails=a(b[0])},link:function(d,e,f,g){function h(){var a=[];angular.forEach(k.$error,function(c,d){c&&a.push({message:d,type:l.$messages[d]&&l.$messages[d].type||b[3]})}),d.$emit("validation",o,a)}function i(){angular.forEach(k.$error,function(a,b){k.$setValidity(b,!0)})}var j,k=g[0],l=g[1],m=g[2],n=a(g[3].$name)(d),o=a(k.$name)(d),p=f.afTriggerOn||m.triggerOn||c.triggerOn();if("change"===p){var q=n+'["'+o+'"]';d.$watch("["+q+".$error, "+q+".$dirty]",function(a,b){(a[0]!==b[0]||a[1])&&h()},!0)}else"blur"===p&&e.on("blur",function(){d.$apply(h)});d.$watch(f.afTrigger,function(a,b){b!==a&&h()}),k.$viewChangeListeners.push(function(){j&&(j=!1,i())}),d.$on("validate",function(){i(),k.$validate?k.$validate():k.$setViewValue(k.$viewValue),h()}),d.$on("setValidity",function(a,b,c){b===n+"."+o&&(j=!0,angular.forEach(c,function(a){l.setMessageDetails(a.message,a.type),k.$setValidity(a.message,!1)}))})}}}]),angular.module("angularFormMessages").directive("afMessageLabel",["$interpolate","$log","$translate","AfMessageService",function(a,b,c,d){return{restrict:"A",require:["^form","^afMessages"],link:function(e,f,g,h){g.$observe("afMessageLabel",function(g){function i(a){f.html(a)}if(g){var j=h[0],k=h[1],l=a(j.$name)(e)+"."+(k.messageId||k.messageIdPrefix)+"."+g,m=d.getGenericLabelPrefix()+g;c(l).then(i)["catch"](function(){c(m).then(i)["catch"](function(){b.warn("Missing label: '"+l+"' (specific) or '"+m+"' (generic)"),i(g)})})}})}}}]),angular.module("angularFormMessages").constant("MESSAGE_TYPES",["SUCCESS","INFO","WARNING","ERROR"]).constant("SHOW_MULTIPLE",{ALL:!0,ONE:!1,ONE_PER_MESSAGE_ID:"ONE_PER_MESSAGE_ID"}).provider("AfMessageService",["MESSAGE_TYPES","SHOW_MULTIPLE",function(a,b){var c,d=!0,e=b.ALL,f=!1,g="change";this.setGenericLabelPrefix=function(a){c=a},this.setScrollToError=function(a){d=a},this.setShowMultiple=function(a){e=a},this.setShowSuccess=function(a){f=a},this.setTriggerOn=function(a){g=a},this.$get=["SHOW_MULTIPLE",function(b){var h={getMostSevereMessage:function(b){var c,d=-1;return angular.forEach(b,function(b){var e=a.indexOf(b.type);e>d&&(d=e,c=b)}),c},getMessagesToShow:function(c){var d=-1,f={};return e===b.ALL?c:(angular.forEach(c,function(c,g){if(c.length){var i=h.getMostSevereMessage(c),j=a.indexOf(i.type);e===b.ONE_PER_MESSAGE_ID?f[g]=[i]:e===b.ONE&&j>d&&(d=j,f={},f[g]=[i])}}),f)},validation:function(a,b,c,d){a.$on("validation",function(a,e,f){(e===b||d&&0===e.indexOf(b))&&c(e,f)})},getGenericLabelPrefix:function(){return c?c+".":""},scrollToError:function(){return d},showMultiple:function(){return e},showSuccess:function(){return f},triggerOn:function(){return g}};return h}]}]),angular.module("angularFormMessages").directive("afMessages",function(){return{scope:!0,require:"afMessages",controller:angular.noop,link:function(a,b,c,d){d.messageIdPrefix=c.afMessageIdPrefix,d.messageId=c.afMessages||c.afMessageId}}}),angular.module("angularFormMessages").directive("afSubmit",["$rootScope","$timeout","AfMessageService",function(a,b,c){return{require:["form","afSubmit"],controller:angular.noop,link:{pre:function(a,b,d,e){var f=e[1],g=a.$eval(d.afScrollToError);f.scrollToError=!!(void 0===g?c.scrollToError():g);var h=a.$eval(d.afShowSuccess);f.showSuccess=!!(void 0===h?c.showSuccess():h),f.triggerOn=d.afTriggerOn},post:function(c,d,e,f){function g(a){return angular.isObject(a)&&"function"==typeof a.then}function h(f){f.preventDefault(),c.$broadcast("validate"),c.$apply(function(){function f(c){angular.forEach(c.validation,function(b,c){angular.forEach(b,function(b,d){a.$broadcast("setValidity",c+"."+d,b)})}),b(function(){var a=d[0].querySelector(".ng-invalid[af-field]");i.scrollToError&&a&&a.focus()})}if(j.$valid){var h=c.$eval(e.afSubmit);g(h)&&(c.isSubmitting=!0,h["catch"](f)["finally"](function(){c.isSubmitting=!1}))}})}var i=f[1],j=f[0];d.on("submit",h)}}}}]),angular.module("angularFormMessages").directive("afSubmitButton",function(){return{link:function(a,b,c){a.$watch("isSubmitting",function(a){c.$set("disabled",a?"disabled":void 0)})}}});